---
// Non-blocking CSS without Astro.resolve (avoid build error)
const globalCss = '/src/styles/global.css';

interface MetaTags {
  title: string;
  description: string;
  keywords: string;
  canonical: string;
  url: string;
  type: string;
  openGraph: {
    title: string;
    description: string;
    url: string;
    image: string;
    type: string;
    siteName: string;
    locale: string;
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
  };
  twitter: {
    card: string;
    title: string;
    description: string;
    image: string;
  };
}

export interface Props {
  title?: string;
  description?: string;
  keywords?: string;
  image?: string;
  url?: string;
  type?: "article" | "website" | "blog" | "service" | "CollectionPage";
  noindex?: boolean;
  jsonLd?: any[];
  canonical?: string;
  metaTags?: MetaTags;
}

const { metaTags, noindex = false, jsonLd } = Astro.props;

const defaultMetaTags = {
  title: "raja cutting laser Terpercaya #1 di Jawa Barat | raja cutting laser",
  description: "Solusi laser cutting profesional dengan teknologi terdepan. 10+ tahun pengalaman, 1000+ proyek selesai, garansi kualitas premium. Melayani CNC Router, Laser Fiber, Laser CO2, dan Galvo Engraving.",
  keywords: "raja cutting laser, cnc router, laser fiber, laser co2, galvo engraving, jawa barat, bandung, bekasi, bogor, depok, cimahi, sukabumi",
  canonical: typeof Astro.url === 'string' ? Astro.url : Astro.url.href,
  url: typeof Astro.url === 'string' ? Astro.url : Astro.url.href,
  type: "website",
  openGraph: {
    title: "raja cutting laser Terpercaya #1 di Jawa Barat | raja cutting laser",
    description: "Solusi laser cutting profesional dengan teknologi terdepan. 10+ tahun pengalaman, 1000+ proyek selesai, garansi kualitas premium.",
    url: typeof Astro.url === 'string' ? Astro.url : Astro.url.href,
    image: "/images/logo.webp",
    type: "website",
    siteName: "raja cutting laser",
    locale: "id_ID"
  },
  twitter: {
    card: "summary_large_image",
    title: "raja cutting laser Terpercaya #1 di Jawa Barat | raja cutting laser",
    description: "Solusi laser cutting profesional dengan teknologi terdepan.",
    image: "/images/logo.webp"
  }
};

const meta = metaTags || defaultMetaTags;

if (!Astro.site) {
  throw new Error('SITE_URL environment variable is not set. Please update your astro.config.mjs');
}

const siteUrl = new URL(Astro.site);
---

<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>{meta.title}</title>
    <meta name="description" content={meta.description} />
    <meta name="keywords" content={meta.keywords} />
    <meta name="author" content="raja cutting laser Team" />
    <link rel="canonical" href={meta.canonical} />
    <meta name="robots" content={noindex ? "noindex, nofollow" : "index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"} />

    <style data-critical>
      :root{--bg:#0b0b0f;--text:#e5e7eb;--muted:#9ca3af;--btn:#2563eb}
      html{color-scheme:dark}
      body{margin:0;background:var(--bg);color:var(--text)}
      header#main-header{position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center;background:rgba(17,24,39,.9);backdrop-filter:saturate(180%) blur(6px);border-bottom:1px solid rgba(59,130,246,.25);z-index:40}
      main{min-height:100vh}
      .container-custom{max-width:1280px;margin:0 auto;padding:0 1rem}
      .heading-xl{font-size:clamp(2rem,4vw,3rem);line-height:1.1;margin:0.5rem 0 1rem}
      .section-padding{padding:4rem 0}
      .btn-primary{background:var(--btn);color:#fff;border-radius:.75rem}
      .btn-secondary{border-radius:.75rem}
      img{height:auto}
      .cv-auto{content-visibility:auto;contain-intrinsic-size: 1px 1000px}
    </style>

    <link rel="preload" href={globalCss} as="style" />
    <link rel="stylesheet" href={globalCss} media="print" onload="this.media='all'" />
    <noscript><link rel="stylesheet" href={globalCss} /></noscript>

    <meta property="og:type" content={meta.openGraph.type} />
    <meta property="og:title" content={meta.openGraph.title} />
    <meta property="og:description" content={meta.openGraph.description} />
    <meta property="og:url" content={meta.openGraph.url} />
    <meta property="og:image" content={new URL(meta.openGraph.image, siteUrl).href} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content={meta.openGraph.siteName} />
    <meta property="og:locale" content={meta.openGraph.locale} />

    <meta name="twitter:card" content={meta.twitter.card} />
    <meta name="twitter:title" content={meta.twitter.title} />
    <meta name="twitter:description" content={meta.twitter.description} />
    <meta name="twitter:image" content={new URL(meta.twitter.image, siteUrl).href} />

    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <link rel="icon" type="image/webp" href="/images/logo.webp" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <link rel="preload" href="/images/logo.webp" as="image" type="image/webp" />

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="preconnect" href="https://api.whatsapp.com" />
    <link rel="dns-prefetch" href="//api.whatsapp.com" />

    <link rel="alternate" type="application/rss+xml" title="{meta.title} - RSS" href="/rss.xml" />
    <link rel="alternate" hreflang="id" href={meta.canonical} />
    <link rel="alternate" hreflang="x-default" href={meta.canonical} />

    {jsonLd && jsonLd.length > 0 && jsonLd.map(json => (
      <script type="application/ld+json" set:html={JSON.stringify(json)} />
    ))}

    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Organization",
      name: "raja cutting laser",
      url: siteUrl.href,
      logo: new URL("/images/logo.webp", siteUrl).href,
      description: "Solusi laser cutting profesional dengan teknologi terdepan di Jawa Barat",
      telephone: "+62 851 6569 3179",
      email: "info@rajacuttinglaser.com",
      address: {"@type": "PostalAddress", streetAddress: "Jl. Raya Serang No. 123", addressLocality: "Serang", addressRegion: "indonesia", postalCode: "42111", addressCountry: "ID"},
      openingHours: "Mo-Sa 08:00-17:00",
      sameAs: ["https://facebook.com/rajacuttinglaser", "https://instagram.com/rajacuttinglaser", "https://youtube.com/rajacuttinglaser"],
      areaServed: ["Serang", "Tangerang", "Cilegon", "Pandeglang", "Lebak"],
      serviceType: ["Laser Cutting", "CNC Router", "Laser Fiber", "Laser CO2", "Galvo Engraving"]
    })} />

    <meta name="theme-color" content="#00C853" />

    <script>
      (function(){
        try{
          let cls=0; new PerformanceObserver(list=>{for (const e of list.getEntries()){if(!(e as any).hadRecentInput){cls += (e as any).value}}}).observe({type:'layout-shift', buffered:true});
          new PerformanceObserver(list=>{const e=list.getEntries().pop(); if(e){console.log('[CWV] LCP', (e as any).renderTime||(e as any).loadTime)}}).observe({type:'largest-contentful-paint', buffered:true});
          new PerformanceObserver(list=>{const e=list.getEntries().pop(); if(e){console.log('[CWV] FID', (e as any).processingStart - (e as any).startTime)}}).observe({type:'first-input', buffered:true});
          window.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden'){ console.log('[CWV] CLS', cls.toFixed(3)); }});
        }catch(err){}
      })();
    </script>
  </head>
  <body class="antialiased bg-background text-text-main">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-laser-green text-white px-4 py-2 rounded-md z-50">Skip to main content</a>
    <slot name="header" />
    <main id="main-content" class="min-h-screen"><slot /></main>
    <slot name="footer" />
  </body>
</html>